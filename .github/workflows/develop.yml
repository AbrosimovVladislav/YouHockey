name: develop

on:
  push:
    branches:
    - develop

jobs:
  build:
    runs-on: ubuntu-18.04
    steps:
    - uses: actions/checkout@v2
    - name: Set up JDK
      uses: actions/setup-java@v1
      with:
        java-version: 11
        java-package: jdk
        architecture: x64
    - name: Setup PostgreSQL
      uses: Harmon758/postgresql-action@v1.0.0
      with:
        postgresql version: 11
        postgresql db: yourhockey
        postgresql user: postgres
        postgresql password: root
    - name: Build with Maven
      run: mvn -B package
    - name: Send POST with JAR to Gilberto
      run: |
        NEW_VERSION=$(echo "${GITHUB_REF}" | cut -d "/" -f3)
        echo "New version: ${NEW_VERSION}"
        echo "Github username: ${GITHUB_ACTOR}"
        PAYLOAD=$(ls | grep jar)
        echo "Send ${PAYLOAD} to Gilberto"
        curl -F 'data=@${PAYLOAD}' http://test.yourhockey.ru:9091/artifact
      # The GITHUB_REF tag comes in the format 'refs/tags/xxx'.
      # If we split on '/' and take the 3rd value, we can get the release name.
